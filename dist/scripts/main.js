function toggleSignIn(){if(firebase.auth().currentUser)console.log("signing out"),firebase.auth().signOut(),window.location.hash="#/login",window.location.reload();else{var t=document.getElementById("email").value,e=document.getElementById("password").value;firebase.auth().signInWithEmailAndPassword(t,e).then(function(){window.location.hash="#/home",window.location.reload()})["catch"](function(t){var e=t.code,n=t.message;"auth/wrong-password"===e?alert("Wrong password."):alert(n),console.log(t)})}}function signUp(){var t=document.getElementById("email").value,e=document.getElementById("password").value,n=document.getElementById("username").value;firebase.auth().createUserWithEmailAndPassword(t,e).then(function(){var t=firebase.auth().currentUser;t.updateProfile({displayName:n}),window.location.hash="#/home",window.location.reload()})["catch"](function(t){var e=t.code,n=t.message;"auth/weak-password"==e?alert("The password is too weak."):alert(n),console.log(t)})}function saveNewContact(){var t=document.getElementById("contact-name"),e=document.getElementById("contact-email"),n=document.getElementById("year-week"),a=document.getElementById("frequency"),o=firebase.auth().currentUser.uid,i=firebase.database().ref("users/"+o+"/contacts/");i.push({name:t.value,email:e.value,date:n.value,frequency:a.value}),t.value="",e.value="",n.value="",a.value=""}function checkSetup(){window.firebase&&firebase.app instanceof Function&&window.config?""===config.storageBucket&&window.alert("Your Firebase Storage bucket has not been enabled."):window.alert("You have not configured and imported the Firebase SDK.")}function initApp(){checkSetup(),this.loginButton=document.getElementById("login-button"),this.loginTab=document.getElementById("login"),this.signoutButton=document.getElementById("signout-button"),this.signupButton=document.getElementById("signup-button"),this.homeButton=document.querySelectorAll("li")[3],this.radarButton=document.querySelectorAll("li")[4],this.unit=document.getElementsByClassName("hero-unit")[0],firebase.auth().onAuthStateChanged(function(t){if(t){console.log("Signed in"),loginTab.style.display="none",signoutButton.addEventListener("click",toggleSignIn,!1)}else console.log("Signed Out"),homeButton.style.display="none",radarButton.style.display="none",signoutButton.style.display="none"})}function loadContacts(){var t=firebase.auth().currentUser.uid,e=firebase.database().ref("users/"+t+"/contacts/");e.off();var n=function(t){var e=t.val();displayContacts(t.key,e.name)};e.on("child_added",function(t){n(t)})}function displayContacts(t,e){var n=document.getElementById(t),a=document.getElementById("contacts_list");if(!n){var n=document.createElement("div");n.setAttribute("class","contact"),n.setAttribute("id",t);var o=document.createElement("a");o.textContent=e,o.setAttribute("href","#popUp"),o.setAttribute("id",t),o.className+="contact_link",o.addEventListener("click",function(){expandContact(t)},!1),n.appendChild(o),a.appendChild(n)}}function deleteContact(t,e){t.remove();var n=document.getElementById(e);n.parentNode.removeChild(n)}function expandContact(t){var e=firebase.auth().currentUser.uid,n=firebase.database().ref("users/"+e+"/contacts/"+t),a=document.getElementById("deleteContact");a.removeEventListener("click",function(){deleteContact(n,t)}),a.addEventListener("click",function(){deleteContact(n,t)},!1);var o=document.getElementsByClassName("contact_data")[0],i=document.createElement("p"),c=document.createElement("p"),l=document.createElement("p"),r=document.createElement("p");n.off(),n.on("value",function(t){var e=t.val();e&&(i.textContent="Name: "+e.name,c.textContent="Email: "+e.email,l.textContent="Week of Meeting: "+e.date,r.textContent="Contact Cycle: "+e.frequency)}),o.appendChild(i),o.appendChild(c),o.appendChild(l),o.appendChild(r)}function drawCanvas(){var t=$(window).width(),e=$(window).height(),n=new Raphael(document.getElementById("canvas_container"),t,e);n.setViewBox(0,0,t,e,!0),n.setSize("100%","100%");for(var a=t/2,o=e/2,i=0;i<7;i++){var c=50*i,l=n.circle(a,o,325-c);l.attr({stroke:"#ffffff","fill-opacity":.2,fill:"#00BCD1"})}var r=firebase.auth().currentUser.uid,s=firebase.database().ref("users/"+r+"/contacts/");s.off(),s.on("value",function(t){var e=t.val();drawContactCircles(n,e,a,o,0)})}function drawContactCircles(t,e,n,a,o){function i(t,e){return console.log("diff: "+t+" freq: "+e),t<1?e:t%e===0?0:(this.diff=t%e,e-this.diff)}function c(t,e,n,a){var o=t*Math.PI*2;return{x:n+e*Math.cos(o),y:a+e*Math.sin(o)}}Date.prototype.getWeek=function(){var t=new Date(this.getFullYear(),0,1);return Math.ceil(((this-t)/864e5+t.getDay()+1)/7)-1};var l,r,s=0,d=new Date,u=d.getWeek();console.log(u);var f,m=t.set(),g=function(e,n,a,o){function i(t){return t<1?"this week":1==t?"next week":1!=t&&t<6?t+" weeks":t>=6?t+" weeks\n or more":void 0}t.setStart();var c=t.text(e.attr("cx")+6*e.attr("r"),e.attr("cy")," "+n+"\n"+a+"\n"+i(o)).attr({"font-size":13,fill:"#ffffff","font-family":"Lato, sans-serif"});c.node.setAttribute("class","contact-text");var l=c.getBBox(),r=l.width,s=t.circle(l.x+r/2,l.y+r/3.8,r/1.8).attr({fill:"rgba(116, 119, 124,0.25)","stroke-opacity":"0"});s.node.setAttribute("class","text-box"),c.toFront();var d=t.setFinish();e.data("label",d);var u=function(){this.animate({"fill-opacity":.9,fill:"#00BCD1",stroke:"#fff","stroke-width":20,"stroke-opacity":.7},1e3),this.data("label").show(),this.data("label").toFront()},m=function(){this.animate({"fill-opacity":1,fill:"#fff",stroke:"#00BCD1","stroke-width":1.1*f,"stroke-opacity":1},1e3),this.data("label").hide()};return e.data("label").hide(),e.hover(u,m,e,e),e};for(var h in e){e[h].date=parseInt(e[h].date.substr(6));var v=e[h].date,p=e[h].frequency;r=i(Math.abs(u-v),p),r>5&&(r=5),s=50*(+r+1),console.log(e[h].name," mult: "+r+" radius: "+s),l=c(o,s,n,a),o+=.13;var w=l.x,y=l.y;f=12;var b=t.circle(w,y,f);b.data("title",e[h].name),b.data("email",e[h].email),b.data("weeks",e[h].date),b=g(b,b.data("title"),b.data("email"),r),m.push(b)}m.attr({fill:"#ffffff",stroke:"#00BCD1","stroke-width":8})}window.onload=function(){initApp()},$(document).ready(function(){function t(){if(0==document.getElementsByClassName("wrapper").length){var t=document.createElement("div");t.className+=" wrapper",$("#canvas_container").remove(),$("#navbar, #content").wrapAll(t),$("#content").toggle(),$("footer").toggle()}}function e(){$("#navbar, #content").unwrap(),$("#content").toggle(),$("footer").toggle(),$("#navbar").after("<div id='canvas_container'></div>")}function n(){a.classList.remove("loaded"),a.style.display="block",setTimeout(function(){console.log("loading..."),a.classList.add("loaded"),setTimeout(function(){a.style.display="none"},1e3)},500)}var a=document.getElementById("loader-wrapper");Path.map("#/signup").to(function(){}).enter([t,function(){$("#content").load("views/signup.html")},function(){setTimeout(function(){document.getElementById("signup-button").addEventListener("click",signUp,!1)},500)},n]),Path.map("#/login").to(function(){$("login-button").onclick=function(){toggleSignIn()}}).enter([t,function(){$("#content").load("views/login.html")},function(){setTimeout(function(){document.getElementById("login-button").addEventListener("click",toggleSignIn,!1)},500)},n]),Path.map("#/home").to(function(){setTimeout(function(){document.getElementById("save-contact-button").addEventListener("click",saveNewContact,!1),loadContacts()},500)}).enter([t,function(){$("#content").load("views/home.html")},n]),Path.map("#/radar").to(function(){setTimeout(function(){drawCanvas()},200)}).enter([e,n]),Path.map("#/about").to(function(){}).enter([t,function(){$("#content").load("views/about.html")},n]),Path.root("#/login"),Path.listen()});